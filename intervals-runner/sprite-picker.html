<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Choose Runner Sprite</title>
  <link rel="stylesheet" href="/css/styles.css" />
  <style>
    .grid { display:grid; grid-template-columns: repeat(auto-fill, minmax(180px,1fr)); gap:12px; }
    .card { background: var(--app-interactive-surface); border:1px solid var(--app-interactive-border); border-radius:12px; padding:10px; display:flex; flex-direction:column; align-items:center; gap:8px; }
    .card img { width: 160px; height: 160px; object-fit: contain; background:#fff; border-radius:8px; }
    .prompt { font-size:.8rem; color: var(--app-text-secondary); max-height:4.5em; overflow:hidden; }
    .actions { display:flex; gap:8px; }
  </style>
</head>
<body>
  <div class="container ui-card">
    <h1>Pick a Sprite</h1>
    <p>Click Use to set the runner to that sprite. You can open the runner after picking.</p>
    <div id="grid" class="grid" aria-live="polite"></div>
  </div>
  <script>
    async function load() {
      try {
        const res = await fetch('/intervals-runner/sprites.json', { cache: 'no-store' });
        if (!res.ok) throw new Error('Failed to load sprites.json');
        const data = await res.json();
        const items = (data && Array.isArray(data.items)) ? data.items : [];
        const grid = document.getElementById('grid');
        grid.textContent='';
        items.forEach((it, i) => {
          const card = document.createElement('div'); card.className='card';
          const img = document.createElement('img'); img.src = it.file; img.alt = `Generated sprite ${i+1}`; card.appendChild(img);
          const p = document.createElement('div'); p.className='prompt'; p.textContent = it.prompt || ''; card.appendChild(p);
          const actions = document.createElement('div'); actions.className='actions';
          const useBtn = document.createElement('button'); useBtn.className='control-btn ui-pill'; useBtn.textContent='Use';
          useBtn.addEventListener('click', () => {
            try { localStorage.setItem('runnerSprite', it.file); } catch {}
            window.location.href = '/intervals-runner/?sprite=' + encodeURIComponent(it.file);
          });
          const viewBtn = document.createElement('a'); viewBtn.className='control-btn ui-pill'; viewBtn.textContent='Open image'; viewBtn.href=it.file; viewBtn.target='_blank';
          actions.appendChild(useBtn); actions.appendChild(viewBtn); card.appendChild(actions);
          grid.appendChild(card);
        });
      } catch (e) {
        const grid = document.getElementById('grid');
        grid.textContent = 'No sprites found yet. Run: npm run sprites:generate';
      }
    }
    load();
  </script>
</body>
</html>

