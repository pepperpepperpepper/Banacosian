<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Melodic Dictation - Ear Training</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
            <div class="container ui-card">
        <h1>ðŸŽ¹ Melodic Dictation</h1>
        
        
        
        <div class="game-controls">
            <div class="main-action-row">
                <button class="control-btn ui-pill" id="newSequenceBtn">Start</button>
                <button class="control-btn ui-pill" id="playSequenceBtn" disabled>Replay</button>
                <button class="control-btn ui-pill" id="settingsToggle" aria-expanded="false" aria-controls="settingsPanel">Settings</button>
            </div>
            <div class="settings-row" id="settingsPanel" hidden>
                <select id="difficulty" class="select-pill ui-pill">
                    <option value="2">2 notes</option>
                    <option value="3" selected>3 notes</option>
                    <option value="4">4 notes</option>
                    <option value="5">5 notes</option>
                </select>
                <select id="tonicSelect" class="select-pill ui-pill" aria-label="Select tonic"></select>
                <select id="scaleType" class="select-pill ui-pill">
                    <option value="diatonic" selected>Diatonic</option>
                    <option value="chromatic">Chromatic</option>
                </select>
                <select id="mode" class="select-pill ui-pill">
                    <option value="ionian" selected>Ionian</option>
                    <option value="dorian">Dorian</option>
                    <option value="phrygian">Phrygian</option>
                    <option value="lydian">Lydian</option>
                    <option value="mixolydian">Mixolydian</option>
                    <option value="aeolian">Aeolian</option>
                    <option value="locrian">Locrian</option>
                    <option value="chromatic">Chromatic</option>
                    <option value="half-whole">Half-Whole</option>
                    <option value="whole-half">Whole-Half</option>
                    <option value="whole-tone">Whole Tone</option>
                </select>
                <select id="timbreSelect" class="select-pill ui-pill" aria-label="Select timbre"></select>
                <select id="staffFont" class="select-pill ui-pill" aria-label="Select staff font"></select>
            </div>
        </div>

        <div class="status-area">
            <div class="feedback" id="feedback"></div>
            
            <div id="sequenceDisplay" class="sequence-display"></div>
            
            <div id="userSequenceDisplay" class="sequence-display" style="margin-top: 10px;"></div>
        </div>

        <div
            id="staff-vexflow"
            class="vexflow-display interaction-draggable"
            role="img"
            aria-label="Rendered musical staff"
            data-staff-min-width="110"
            data-staff-target-width="130"
            data-staff-max-width="150"
            data-staff-base-height="120"
            data-staff-scale="3"
        ></div>

        <div class="piano">
            <div class="piano-keys" aria-label="Interactive piano keyboard"></div>
        </div>

<div class="timer-display">
            <div class="timer" id="timer">00:00</div>
            <div class="round-progress">
                Score: <span id="correct">0</span> / <span id="total">0</span>
                (<span id="percentage">0</span>%)
            </div>
            <div class="round-accuracy">
                Current Accuracy: <span id="currentAccuracy">0%</span>
            </div>
        </div>
        <div class="data-controls">
            <div class="data-row">
                <button class="control-btn ui-pill" id="showHistoryBtn">ðŸ“Š View History</button>
                <button class="control-btn ui-pill" id="saveDataBtn">ðŸ’¾ Save to Drive</button>
            </div>
            <div class="data-row">
                <button class="control-btn ui-pill" id="loadDataBtn">ðŸ“‚ Load from Drive</button>
            </div>
        </div>

        <div id="historyModal" class="modal">
            <div class="modal__dialog">
                <div class="modal__header">
                    <h2 class="modal__title">ðŸ“Š Session History</h2>
                    <button id="closeHistoryBtn" class="ui-pill modal__close" type="button">âœ• Close</button>
                </div>
                <div id="historyContent" class="modal__content"></div>
            </div>
        </div>

        <div class="instructions">
            <strong>How to play:</strong><br>
            1. Choose sequence length and click "Start"<br>
            2. Listen carefully to the melody<br>
            3. Play it back on the piano keyboard<br>
            4. Get feedback after completing the sequence<br>
            5. Use "Replay" to hear the original again
        </div>
    </div>
    <!-- Modular JavaScript files -->
    <script src="https://cdn.jsdelivr.net/npm/tonal@4.14.2/browser/tonal.min.js"></script>
    <script src="js/modules/Audio.js"></script>
    <script src="js/modules/MusicTheory.js"></script>
    <script src="js/modules/Keyboard.js"></script>
    <script src="js/modules/Staff.js"></script>
    <script src="js/modules/Scoring.js"></script>
    <script src="js/modules/SettingsStore.js"></script>
    <script src="js/modules/MidiInput.js"></script>
    <script src="js/modules/Storage.js"></script>
    <script src="js/modules/UI.js"></script>
    <script src="js/MelodicDictation.js"></script>
</body>
</html>
