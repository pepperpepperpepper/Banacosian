<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ABCJS SMuFL Experiment</title>
  <script>
    (() => {
      const param = 'cb';
      const url = new URL(window.location.href);
      if (!url.searchParams.has(param)) {
        url.searchParams.set(param, Date.now().toString(36));
        window.location.replace(url.toString());
      }
    })();
  </script>
  <link rel="stylesheet" href="/staff/font/styles.css">
  <script src="https://cdn.jsdelivr.net/npm/abcjs@6.2.2/dist/abcjs-basic-min.js" defer></script>
</head>
<body>
  <main>
    <header>
      <h1>SMuFL Font Experiment</h1>
      <p>
        This sandbox renders a treble staff with <strong>ABCJS</strong> and then swaps its SVG glyphs
        for characters from the <em>Bravura</em> SMuFL font. Use the toggle to compare the default
        engraving with the experimental SMuFL-driven rendering.
      </p>
    </header>

    <section class="controls">
      <label for="font-select" class="font-label">VexFlow Font</label>
      <select id="font-select" class="font-select" aria-label="VexFlow SMuFL font">
        <option value="bravura">Bravura (reference)</option>
        <option value="petaluma">Petaluma (handwritten)</option>
        <option value="leland">Leland</option>
      </select>
      <button id="render-default" class="primary">Render ABCJS Staff</button>
      <button id="render-smufl">Refresh</button>
    </section>

    <section class="staff-demo">
      <h2>VexFlow Prototype</h2>
      <div id="vexflow-container" class="vexflow-container" aria-live="polite"></div>
      <p id="vexflow-status" class="status"></p>
    </section>

    <section class="staff-demo">
      <div id="staff-container" aria-live="polite"></div>
      <p id="status" class="status"></p>
      <div id="error-log" class="error-log" aria-live="polite" aria-atomic="false"></div>
    </section>

    <section class="notes">
      <h2>Under the Hood</h2>
      <ul>
        <li>Loads the Bravura font (SMuFL reference implementation) directly in the browser.</li>
        <li>Maps ABCJS notehead and accidental classes to SMuFL code points using metadata.</li>
        <li>Replaces SVG paths with positioned <code>&lt;text&gt;</code> elements from the font.</li>
      </ul>
      <p class="footnote">
        This is a proof-of-conceptâ€”spacing, beam anchors, and articulation metrics still need deeper integration with SMuFL metadata.
      </p>
    </section>
  </main>

  <script type="module" src="/staff/font/font-demo.js?v=20251030c"></script>
  <script type="module" src="/staff/font/vexflow-demo.js?v=20251030c"></script>
</body>
</html>
